# Documentatie  
Antwerp Has Fallen is een android applicatie die communiceert met een .NET core API. Deze beschikt dan ook over een MySQL database. We zijn begonnen met de API en de database op Azure maar na wat problemen hiermee zijn we overgeschakeld naar Google Cloud Platform.   

We hadden eerst geprobeerd het op te lossen door gebruik te maken van IIS en zo de servers lokaal te kunnen draaien voor de app te kunnen testen maar 2 teamleden konden deze niet opstarten dus moesten we naar een ander alternatief zoeken en heeft meneer Peeters ons geholpen met het Google Cloud Platform op te zetten.  
## Google Cloud Platform  
De .NET core API wordt gehost via Google Cloud Platform. Om hier naar te publishen moeten er enkele configuratie aanpassingen gedaan worden. Als eerste moet er in de [Startup.cs](./src/AHF-API/AntwerpHasFallen/Startup.cs) het deel met de MySql connectionstring uit commentaar worden gehaald en het deel met de SqlServer in commentaar gezet worden. Dit omdat de settings met de SqlServer gebruikt worden om de API lokaal te hosten, met een localdb connectionstring. Deze connectionstring moet dus ook vervangen worden met de connectionstring van de MySql database op Google Cloud Platform. Dit moet in [appsettings.json](./src/AHF-API/AntwerpHasFallen/appsettings.json) gebeuren. De connectionstring van de MySql database staat niet in github omdat hier wachtwoorden in staan.  

Na deze configuratie aangepast te hebben, hebben we google cloud console nodig. Navigeer naar *"./src/AHF-API/AntwerpHasFallen/"* en voer het commando *"dotnet publish -c test"* uit. Normaal is *"test"* *"Release"* of *"Debug"* maar doordat onze API eerst naar Azure gepublished werd zitten hier enkele files in die voor errors zorgen. Maar *test* kan vervangen worden door een andere map, hier worden de build files naartoe gekopieërd.  
Navigeer dan naar *"./src/AHF-API/AntwerpHasFallen/bin/test/netcoreapp2.1/publish"*. Voer hier het commando *"gcloud app deploy"* uit. Het is mogelijk om hier een versie nummer aan mee te geven met *"--version **versienummer**"* dit mag echter wel geen ‘.’ bevatten zoals in v1.0.  
Na dit commando bevestigd te hebben wordt de api gepublished.  

Om de API lokaal te gebruiken moet er een aanpassing gedaan worden in de code van de app. In [RetrofitInstance.java](./src/AHF-App/app/src/main/java/com/ahf/antwerphasfallen/Helpers/RetrofitInstance.java) moet de variabele BASE_URL aangepast worden. Deze url word dan het adres waar de server op draait + "*/api*".
## Maps API  
Voor de android maps API moet er een project aangemaakt worden op het Google Cloud Platform, hier kan je dan de Maps SDK voor Android selecteren, deze activeren en een API-key genereren. Deze API-key moet dan in de AndroidManifest.xml van de android applicatie gestoken worden. daar staat een meta-data tag met een API_KEY in, deze waarde moet dan aangepast worden naar de nieuwe API-key.
## App  
Om de app en het spel op te starten zoals het nu is is er eigenlijk niet veel nodig, je kan gewoon de app opstarten en een game aanmaken. Als je dan in het menu links naar het "team" scherm gaat kan je zo het game-id terug vinden om deze dan door te geven aan de andere teams zodat ze dezelfde game kunnen joinen.  
De android app bestaat uit 3 activities, de eerste activity is het [startscherm](./src/AHF-App/app/src/main/java/com/ahf/antwerphasfallen/MainActivity.java), dit is het scherm waar je op komt als je de app opstart en dit is ook het scherm waar je op komt als je voorbij het eind scherm bent gegaan. De volgende activity is de [InGameActivity](./src/AHF-App/app/src/main/java/com/ahf/antwerphasfallen/InGameActivity.java) hier gebeurt eigenlijk alles dat met het spel zelf te maken heeft. De InGameActivity beschikt over een FrameLayout die we als fragment container gebruiken. Alle andere schermen die te zien zijn in het spel zelf zijn dus allemaal [fragments](./src/AHF-App/app/src/main/java/com/ahf/antwerphasfallen/Fragments/) die we dus in deze container kunnen zetten. Ook beschikt de InGameActivity over een navigation drawer die het menu laat zien met alle mogelijke schermen en dan ook het juiste fragment in de container zet zodat deze het juiste scherm toont op de juiste moment. De laatste activity is de [EndActivity](./src/AHF-App/app/src/main/java/com/ahf/antwerphasfallen/EndActivity.java), deze wordt getoond als er een team alle ingrediënten gevonden heeft voor “The Cure” te maken. Op dit scherm komt dan te staan welk team dat gewonnen heeft en dan een ranking van alle teams.


